{
  "name": "📱 PRODUÇÃO - Airdrops → WhatsApp",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 6
            }
          ]
        }
      },
      "id": "schedule-6h",
      "name": "⏰ A cada 6 horas",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [240, 300]
    },
    {
      "parameters": {
        "url": "https://SEU-APP.onrender.com/health",
        "options": {}
      },
      "id": "check-health",
      "name": "🏥 Verificar API",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [460, 300]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "condition1",
              "leftValue": "={{ $json.status }}",
              "rightValue": "online",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        }
      },
      "id": "api-online",
      "name": "🔍 API Online?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [680, 300]
    },
    {
      "parameters": {
        "url": "https://SEU-APP.onrender.com/n8n/best-airdrops",
        "options": {
          "queryParametersUi": {
            "parameter": [
              {
                "name": "limit",
                "value": "5"
              }
            ]
          }
        }
      },
      "id": "get-airdrops",
      "name": "🚀 Buscar Top 5 Airdrops",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [900, 200]
    },
    {
      "parameters": {
        "jsCode": "// Formatar mensagem para WhatsApp\nconst data = $input.first().json;\nconst airdrops = data.airdrops || [];\n\nif (airdrops.length === 0) {\n  return {\n    skip: true,\n    message: 'Nenhum airdrop encontrado'\n  };\n}\n\n// Criar mensagem formatada\nlet message = '🚀 *TOP ' + airdrops.length + ' AIRDROPS DO MOMENTO*\\n\\n';\n\n// Emojis para chains\nconst chainEmojis = {\n  'ETH': '🔷',\n  'ETHEREUM': '🔷',\n  'BSC': '🟡', \n  'POLYGON': '🟣',\n  'ARBITRUM': '🔵',\n  'OPTIMISM': '🔴',\n  'SOLANA': '🟢',\n  'SOL': '🟢',\n  'AVAX': '⚪'\n};\n\n// Emojis para status\nconst statusEmojis = {\n  'ACTIVE': '✅',\n  'TBD': '⏳',\n  'ENDED': '❌',\n  'UPCOMING': '🔜'\n};\n\nairdrops.forEach((airdrop, index) => {\n  const chainEmoji = chainEmojis[airdrop.chain?.toUpperCase()] || '⛓️';\n  const statusEmoji = statusEmojis[airdrop.status?.toUpperCase()] || '📊';\n  \n  message += `${index + 1}. *${airdrop.name}*\\n`;\n  message += `💰 Valor: ${airdrop.value}\\n`;\n  message += `${chainEmoji} Chain: ${airdrop.chain || 'Multi'}\\n`;\n  message += `${statusEmoji} Status: ${airdrop.status}\\n`;\n  \n  if (airdrop.deadline) {\n    message += `⏰ Deadline: ${airdrop.deadline}\\n`;\n  }\n  \n  message += '\\n';\n});\n\nmessage += `_🕐 Atualizado: ${new Date().toLocaleString('pt-BR')}_\\n`;\nmessage += '_📊 Dados via DeFiLlama MCP_\\n';\nmessage += '_🤖 Enviado automaticamente a cada 6h_';\n\nreturn {\n  message: message,\n  count: airdrops.length,\n  timestamp: new Date().toISOString(),\n  airdrops: airdrops\n};"
      },
      "id": "format-message",
      "name": "✏️ Formatar Mensagem",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1120, 200]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "condition1",
              "leftValue": "={{ $json.skip }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "notEqual"
              }
            },
            {
              "id": "condition2",
              "leftValue": "={{ $json.count }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        }
      },
      "id": "has-airdrops",
      "name": "📊 Tem Airdrops?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1340, 200]
    },
    {
      "parameters": {
        "url": "http://localhost:8080/message/sendText/SUA-INSTANCIA",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {
          "bodyContentType": "json",
          "jsonBody": "{\n  \"number\": \"5511999999999@c.us\",\n  \"text\": \"{{ $json.message }}\"\n}",
          "headers": {
            "apikey": "SUA_API_KEY_EVOLUTION",\n            "Content-Type": "application/json"\n          }\n        },\n        "method": "POST"\n      },\n      "id": "send-whatsapp",\n      "name": "📱 Enviar WhatsApp",\n      "type": "n8n-nodes-base.httpRequest",\n      "typeVersion": 4.1,\n      "position": [1560, 120]\n    },\n    {\n      "parameters": {\n        "message": "⚠️ API DeFiLlama offline ou sem resposta",\n        "options": {}\n      },\n      "id": "api-offline-error",\n      "name": "❌ API Offline",\n      "type": "n8n-nodes-base.stopAndError",\n      "typeVersion": 1,\n      "position": [680, 500]\n    },\n    {\n      "parameters": {\n        "jsCode": "// Log de sucesso\\nconsole.log('✅ Mensagem enviada com sucesso para WhatsApp');\\nconsole.log('📊 Airdrops enviados:', $input.first().json.count);\\nconst response = $input.first().json;\\n\\nreturn {\\n  status: 'success',\\n  message: 'Airdrops enviados para WhatsApp',\\n  count: $('✏️ Formatar Mensagem').first().json.count,\\n  timestamp: new Date().toISOString(),\\n  whatsapp_response: response\\n};"\n      },\n      "id": "log-success",\n      "name": "✅ Log Sucesso",\n      "type": "n8n-nodes-base.code",\n      "typeVersion": 2,\n      "position": [1780, 120]\n    },\n    {\n      "parameters": {\n        "url": "http://localhost:8080/message/sendText/SUA-INSTANCIA",\n        "authentication": "genericCredentialType",\n        "genericAuthType": "httpHeaderAuth",\n        "options": {\n          "bodyContentType": "json",\n          "jsonBody": "{\n  \"number\": \"5511999999999@c.us\",\n  \"text\": \"⚠️ *Aviso Sistema*\\n\\nNenhum airdrop encontrado no momento.\\n\\n_Sistema funcionando normalmente_\\n_Próxima verificação em 6 horas_\"\n}",\n          "headers": {\n            "apikey": "SUA_API_KEY_EVOLUTION",\n            "Content-Type": "application/json"\n          }\n        },\n        "method": "POST"\n      },\n      "id": "send-no-airdrops",\n      "name": "📱 Aviso: Sem Airdrops",\n      "type": "n8n-nodes-base.httpRequest",\n      "typeVersion": 4.1,\n      "position": [1560, 300]\n    }\n  ],\n  "connections": {\n    "⏰ A cada 6 horas": {\n      "main": [\n        [\n          {\n            "node": "🏥 Verificar API",\n            "type": "main",\n            "index": 0\n          }\n        ]\n      ]\n    },\n    "🏥 Verificar API": {\n      "main": [\n        [\n          {\n            "node": "🔍 API Online?",\n            "type": "main",\n            "index": 0\n          }\n        ]\n      ]\n    },\n    "🔍 API Online?": {\n      "main": [\n        [\n          {\n            "node": "🚀 Buscar Top 5 Airdrops",\n            "type": "main",\n            "index": 0\n          }\n        ],\n        [\n          {\n            "node": "❌ API Offline",\n            "type": "main",\n            "index": 0\n          }\n        ]\n      ]\n    },\n    "🚀 Buscar Top 5 Airdrops": {\n      "main": [\n        [\n          {\n            "node": "✏️ Formatar Mensagem",\n            "type": "main",\n            "index": 0\n          }\n        ]\n      ]\n    },\n    "✏️ Formatar Mensagem": {\n      "main": [\n        [\n          {\n            "node": "📊 Tem Airdrops?",\n            "type": "main",\n            "index": 0\n          }\n        ]\n      ]\n    },\n    "📊 Tem Airdrops?": {\n      "main": [\n        [\n          {\n            "node": "📱 Enviar WhatsApp",\n            "type": "main",\n            "index": 0\n          }\n        ],\n        [\n          {\n            "node": "📱 Aviso: Sem Airdrops",\n            "type": "main",\n            "index": 0\n          }\n        ]\n      ]\n    },\n    "📱 Enviar WhatsApp": {\n      "main": [\n        [\n          {\n            "node": "✅ Log Sucesso",\n            "type": "main",\n            "index": 0\n          }\n        ]\n      ]\n    }\n  },\n  "pinData": {},\n  "settings": {\n    "executionOrder": "v1"\n  },\n  "staticData": null,\n  "tags": [\n    {\n      "id": "prod",\n      "name": "produção"\n    },\n    {\n      "id": "whatsapp",\n      "name": "whatsapp"\n    }\n  ],\n  "triggerCount": 1,\n  "updatedAt": "2024-01-01T00:00:00.000Z",\n  "versionId": "1"\n}